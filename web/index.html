<!DOCTYPE html>
<html>
<head>
<title>osc.js Web Socket Demo</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" sizes="180x180" href="assets/images/bitwig-192.png">

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" type="text/css" media="all" href="assets/css/osc-view.css"></link>
<script src="node_modules/jquery/dist/jquery.js"></script>
<script src="node_modules/osc/dist/osc-browser.min.js"></script>
<script src="../local-url.js"></script>
<script src="assets/js/live.js"></script>

<script type="text/javascript">

var bitwig = {};



bitwig.parseMessage = function (oscMessage) {
	var currentMessage = oscMessage;
	console.log(">> bitwig.parseMessage");
	if (currentMessage.address == "/track/name"){
		bitwig.currentTrackName(currentMessage);
	} else if (currentMessage.address == "/track/color"){
		bitwig.currentTrackColor(currentMessage);
	} else if (currentMessage.address == "/track/devices"){
		bitwig.currentTrackDevices(currentMessage);
	}

}

bitwig.currentTrackName = function (oscMessage) {

	console.log(">> bitwig.currentTrackName");
	console.log(oscMessage.args[0]);

	var currentTrack = oscMessage;
	var trackName = oscMessage.args[0];
	$("#currentTrack").text(trackName);

}

bitwig.currentTrackColor = function (oscMessage) {

	console.log(">> bitwig.currentTrackColor");
	console.log(oscMessage.args[0]);
	console.log(oscMessage.args[1]);
	console.log(oscMessage.args[2]);

	var currentTrack = oscMessage;
	var trackRed = oscMessage.args[0];
	var trackGreen = oscMessage.args[1];
	var trackBlue = oscMessage.args[2];

	var strBegin = "rgb(";
	var strComma = ", ";
	var strEnd = ")";
	var strFull = strBegin.concat(trackRed, strComma, trackGreen, strComma, trackBlue, strEnd);
	console.log(strFull);

	$("#currentTrack").css("background-color", strFull);

}

bitwig.currentTrackDevices = function (oscMessage) {

	console.log(">> bitwig.currentTrackDevices");
	console.log(oscMessage.args);

	var currentTrack = oscMessage;
	// var trackDevice1 = oscMessage.args[0];
	// $("#currentTrack").text(trackName);

	$('#devices').html('')
	$.each( currentTrack.args, function( index, value ){
		$('#devices').append('<button data-index="' + index + '">'+ value +'</button>');

	});

	$("#devices button").on( "click", function() {

		$("#devices button").removeClass( "deviceActive" );
		$( this ).addClass( "deviceActive" );
		var currentDeviceIndex = $( this ).data( "index" );
		// console.log("bananananannananan" + currentDeviceIndex );
		port.send({
			address: "/device",
			args: [currentDeviceIndex]
		});

	});

};

var port = new osc.WebSocketPort({
	url: localURL
});

port.on("message", function (oscMessage) {
	$("#message").text(JSON.stringify(oscMessage, undefined, 2));
	bitwig.parseMessage(oscMessage);
});

port.open();

var sayHello = function () {
	port.send({
		address: "/track",
		args: [1]
	});
};


</script>
</head>

<body>

<div id="bwSelector">
	<div id="currentTrack">
	</div>
	<div id="devices">
	</div>
</div>


<div id="messageArea">
	<pre id="message">Select a track</pre>
</div>

<button id="butSend" onclick="sayHello()">Send OSC message</button>

</body>
</html>
