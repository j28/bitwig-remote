<!DOCTYPE html>
<html>
<head>
<title>osc.js Web Socket Demo</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" type="text/css" media="all" href="osc-view.css"></link>

<script src="node_modules/jquery/dist/jquery.js"></script>
<script src="node_modules/osc/dist/osc-browser.min.js"></script>
<script src="node_modules/osc/dist/osc-browser.min.js"></script>
<script src="../local-url.js"></script>
<script src="live.js"></script>

<script type="text/javascript">

var bitwig = {};


bitwig.parseMessage = function (oscMessage) {
	var currentMessage = oscMessage;
	console.log(">> bitwig.parseMessage");
	if (currentMessage.address == "/track"){
		bitwig.currentTrack(currentMessage);
	}

}

bitwig.currentTrack = function (oscMessage) {

		console.log(">> bitwig.currentTrack");
		console.log(oscMessage.args[0]);
		console.log(oscMessage.args[1]);
		console.log(oscMessage.args[2]);
		console.log(oscMessage.args[3]);

		var currentTrack = oscMessage;
		var trackName = oscMessage.args[0];
		var trackRed = oscMessage.args[1];
		var trackGreen = oscMessage.args[2];
		var trackBlue = oscMessage.args[3];

		var strBegin = "rgb(";
		var strComma = ", ";
		var strEnd = ")";
		var strFull = strBegin.concat(trackRed, strComma, trackGreen, strComma, trackBlue, strEnd);
		console.log(strFull);

		document.getElementById("currentTrack").style.backgroundColor = strFull;
		$("#currentTrack").text(trackName);
		document.getElementById("body").innerHTML = "track color is " + strFull;

}

var port = new osc.WebSocketPort({
	url: localURL
});

port.on("message", function (oscMessage) {
	$("#message").text(JSON.stringify(oscMessage, undefined, 2));
	bitwig.parseMessage(oscMessage);
});

port.open();

var sayHello = function () {
	port.send({
		address: "/track",
		args: [1]
	});
};

</script>
</head>

<body>

<div id="bwSelector">
	<div id="currentTrack">
	</div>
</div>


<div id="messageArea">
	<pre id="message">nothing yet</pre>
</div>

<button id="butSend" onclick="sayHello()">Send OSC message</button>

</body>
</html>
